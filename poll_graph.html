<html>
<head>
<script src="libs/d3.v3.min.js"></script>
<script src="scripts/teamcolors.js"></script>
<script src="libs/jquery-1.10.1.js"></script>
</head>
<body>
<script type="text/javascript">

var dataset;
var teams = {};
var teamlines = [];
var weeks = [];

var svg = d3.select("body").append("svg");

d3.csv("data/2012-13-AP.csv", function(error, data) {
	dataset = data;
	console.log(dataset);

	for (var i=0;i<dataset.length;i++) {
		if (dataset[i].Wk === "Wk") {
			dataset.splice(i,1);
		}
	}

	for (var i=0;i<dataset.length;i++) {
		/*if (dataset[i].School.indexOf("Gonzaga") !== -1) {
			console.log(dataset[i].Wk, dataset[i].Rk);

		}*/
		line = dataset[i];
		school = line.School;
		week = parseInt(line.Wk);
		line.Wk = week;
		rank = parseInt(line.Rk);
		line.Rk = rank;
		starIndex = school.indexOf("*");
		if (weeks.indexOf(line.Wk) === -1) {
			weeks.push(line.Wk);
		}
		if (starIndex > 0) {
			school = school.substring(0,starIndex);
			line.School = school;
		}
		if (teams[school]) {
			teams[school].push(line);
		} else {
			teams[school] = [line];
		}
	}

	for (var school in teams) {
		rankedWeeks = [];
		ranks = teams[school];
		ranks.forEach(function(d) {
			rankedWeeks.push(d.Wk);
		})
		if (rankedWeeks.length !== weeks.length) {
			var diff = [];
			var j=0;
			for (var i=0;i<weeks.length;i++) {
				if (rankedWeeks.indexOf(weeks[i]) === -1) {
					diff.push(weeks[i]);
				}
			}
			console.log(school, diff);
			diff.forEach(function(d) {
				teams[school].push({"Wk": d, "Rk": "26"});
			})
		}
		ranks = teams[school];
		ranks.sort(function(a,b) {
			return d3.ascending(a.Wk, b.Wk);
		})
	}

	console.log(teams);

	xscale = d3.scale.linear().domain([1,20]).range([50,1600]);
	yscale = d3.scale.linear().domain([1,25]).range([50,700]);

	xaxis = d3.svg.axis()
				.scale(xscale)
				.orient("bottom")
				.ticks(20);

	yaxis = d3.svg.axis()
				.scale(yscale)
				.orient("left")
				.ticks(25);

	var teamline = d3.svg.line().x(function(d) { return xscale(d.Wk); })
								.y(function(d) { return yscale(d.Rk); })
								.interpolate("cardinal");

	//colorScale = d3.scale.linear().domain([1,25]).range(["red", "green"]);

    svg.append("defs").append("clipPath")
        .attr("id", "clip")
        .append("rect")
        .attr("width", 1550)
        .attr("height", 660)
        .attr("x", 50)
        .attr("y", 40);

	count = 1;
	for (var school in teams) {
		svg.append("path")
			.attr("d", teamline(teams[school]))
			.style("fill", "none")
			.style("stroke-width", 3)
			.style("stroke", searchColor(school))
			.on("mouseover", function(d) {
				var thepath = d3.select(this);
				thepath.style("stroke-width", 10);
			})
			.on("mouseout", function(d) {
				var thepath = d3.select(this);
				thepath.style("stroke-width", 3);
			})
			.style("clip-path", "url(#clip)")
		count++;

		lastRk = teams[school][teams[school].length-1].Rk;
		if (lastRk < 26) {
			svg.append("text")
				.attr("transform", "translate(1603,"+yscale(lastRk)+")")
				.attr("dy", ".25em")
				.attr("text-anchor", "start")
				.style("fill", searchColor(school))
				.text(lastRk + ": " + school);
		}
	}


	svg.append("g")
		.attr("class", "axis")
		.attr("transform", "translate(0,705)")
		.call(xaxis);

	svg.append("g")
		.attr("class", "axis")
		.attr("transform", "translate(50,0)")
		.call(yaxis);

/*	svg.append("path")
		.attr("d", teamline(teams["Gonzaga"]))
		.style("fill", "none")
		.style("stroke", "black");*/

	//console.log(dataset);
})

</script>

</body>
</html>